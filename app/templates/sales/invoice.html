{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4 no-print">
    <h1><i class="fas fa-file-invoice-dollar me-2"></i> Invoice #{{ order.id }}</h1>
    <div>
        <button onclick="window.print()" class="btn btn-primary">
            <i class="fas fa-print me-2"></i> Print Invoice
        </button>
        <a href="{{ url_for('sales.orders') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i> Back to Orders
        </a>
    </div>
</div>

<div class="card shadow" id="invoice-area">
    <div class="card-body p-5">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-6">
                <h2 class="text-primary mb-3">ERP SYSTEM</h2>
                <div class="text-muted">
                    <p class="mb-1">123 Business Road</p>
                    <p class="mb-1">City, State 12345</p>
                    <p class="mb-1">Phone: +91 98765 43210</p>
                    <p class="mb-1">GSTIN: 22AAAAA0000A1Z5</p>
                </div>
            </div>
            <div class="col-6 text-end">
                <h4 class="mb-3">INVOICE</h4>
                <p class="mb-1"><strong>Date:</strong> {{ order.date.strftime('%d-%b-%Y') }}</p>
                <p class="mb-1"><strong>Invoice No:</strong> INV-{{ order.id }}</p>
                <div class="mt-3 badge bg-{{ 'success' if order.status == 'COMPLETED' else 'warning' }} fs-6">
                    {{ order.status }}
                </div>
            </div>
        </div>

        <hr class="my-4">

        <!-- Bill To -->
        <div class="row mb-4">
            <div class="col-6">
                <h5 class="text-muted mb-2">Bill To:</h5>
                {% if order.customer %}
                <h5 class="mb-1">{{ order.customer.name }}</h5>
                <p class="mb-1">{{ order.customer.address or 'No address provided' }}</p>
                <p class="mb-1">Phone: {{ order.customer.phone }}</p>
                {% if order.customer.gstin %}
                <p class="mb-1">GSTIN: {{ order.customer.gstin }}</p>
                {% endif %}
                {% else %}
                <h5>Walk-in Customer</h5>
                {% endif %}
            </div>
        </div>

        <!-- Items Table -->
        <div class="table-responsive mb-4">
            <table class="table table-striped table-bordered">
                <thead class="bg-primary text-white">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Item Description</th>
                        <th scope="col" class="text-center">HSN/SAC</th>
                        <th scope="col" class="text-center">Qty</th>
                        <th scope="col" class="text-end">Unit Price</th>
                        <th scope="col" class="text-end">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.items %}
                    <tr>
                        <th scope="row">{{ loop.index }}</th>
                        <td>
                            <strong>{{ item.product.name }}</strong>
                            <br>
                            <small class="text-muted">{{ item.product.code }}</small>
                        </td>
                        <td class="text-center">-</td> <!-- Add HSN to product model later if needed -->
                        <td class="text-center">{{ item.quantity }}</td>
                        <td class="text-end">₹{{ "{:.2f}".format(item.price) }}</td>
                        <td class="text-end">₹{{ "{:.2f}".format(item.total) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Totals -->
        <div class="row">
            <div class="col-md-6">
                <div class="text-muted">
                    <p class="mb-2"><strong>Terms & Conditions:</strong></p>
                    <small>
                        1. Goods once sold will not be taken back.<br>
                        2. Interest @ 18% p.a. will be charged if payment is not made within the due date.<br>
                        3. Subject to local jurisdiction.
                    </small>
                </div>
            </div>
            <div class="col-md-4 offset-md-2">
                <table class="table table-borderless">
                    <tr>
                        <td class="text-end"><strong>Subtotal:</strong></td>
                        <td class="text-end">₹{{ "{:.2f}".format(order.total_amount) }}</td>
                    </tr>
                    <tr>
                        <td class="text-end"><strong>Discount:</strong></td>
                        <td class="text-end text-danger">- ₹{{ "{:.2f}".format(order.discount or 0) }}</td>
                    </tr>
                    <!-- Tax logic can be added here -->
                    <tr class="border-top">
                        <td class="text-end">
                            <h4><strong>Grand Total:</strong></h4>
                        </td>
                        <td class="text-end">
                            <h4 class="text-primary">₹{{ "{:.2f}".format(order.grand_total) }}</h4>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Signature -->
        <div class="row mt-5">
            <div class="col-12 text-end">
                <br><br>
                <p class="border-top d-inline-block pt-2 px-5">Authorized Signatory</p>
            </div>
        </div>
    </div>
</div>

<style>
    @media print {
        .no-print {
            display: none !important;
        }

        .card {
            border: none !important;
            box-shadow: none !important;
        }

        .card-body {
            padding: 0 !important;
        }

        body {
            background-color: white !important;
        }
    }
</style>
{% endblock %}